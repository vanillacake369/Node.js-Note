# Node.js란

Created: 2022년 8월 4일 오전 9:50
Last Edited Time: 2022년 8월 23일 오후 3:23
State: Done
Tag: node.js

# Node.js란?

---

크롬V8JS엔진으로 빌드된 ***자바스크립트 런타임***

> 서버 아니고요, 엔진아니고요
> 

원래 브라우저가 html읽고 스크립트 읽었음. 따라서 html에 종속적이었음

node를 설치하면 v8 자바스크립트 엔진에 의해 자바스크립트로 작성된 서버를 실행할 수 있음. 즉, html과 브라우저의 종속성에서 벗어남.

웹 개발은 프론트로 인해서 자바스크립트를 해야할 수 밖에 없음

새로운 플랫폼을 위해 새로운 언어를 배우기보다, 노드를 통해 자바스크립트를 돌려버려서 모바일과 데스크탑을 쇽샥할 수 있게 되었음.

즉, 노드는 자바스크립트 실행기임.

노드 자체가 서버가 아니라, 자바스크립트로 짜여진 서버 실행 모듈이 있다면, 이를 노드가 실행해주는 거임. 엄밀히 말하면 서버가 아님.

# 노드 = 런타임

---

런타임이란 특정 언어로 만든 프로그램들을 실행할 수 있게 해주는 가상머신의 상태임.

자바스크립트 조금만 아는데 막히는 부분이 있는 경우 막힐 때마다 공부를 해가지고 오면 됨.

- 자바스크립트는 여기서 한 방에 끝내는 걸 추천함
    
    [모던자바스크립트 튜토리얼](https://ko.javascript.info/)
    
    이걸 보고도 JS를 못 다루겠다? 응 그냥 코딩사고력이 딸리는 거임. 코딩 존나 짜보라고 ㄹㅇㅋㅋ
    
    JS는 언어일 뿐이고, 코딩은 논리력에 의해서 쇽샥쇽샥하는 거임. 생각하는 방법을 익히고 배우셈. 한국인으로 태어나서 영어 말하는 사고를 따로 키워야하는 거와 같음
    

JS 또한 내부 실제 구조는 C나 C++로 작성되어있음. C와 C++의 생산성 때문에 (기계어에 가깝기 때문에 가독성과 긴 코드로 인해 생산성이 너무 떨어짐) JS로 작성되어있음

![Untitled](Node%20js%E1%84%85%E1%85%A1%E1%86%AB%20ee4667af474a49959338d6b471bcee9b/Untitled.png)

[*Node.js의 아키텍처 모델*](https://velog.io/@young18/JS-NodeJS%EC%9D%98-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98)

- V8 : 엔진
- libuv : 비동기(논블로킹) I/O를 구현한 라이브러리 → 서버 프로그래밍을 쉽게 할 수 있게 해줌

# Event

---

대부분의 프로그램은 이벤트 기반임. // ㅇㅇ 당연한 소리쥬?

System → ( Event )→  Event Listener → Server (DNS,DB Server …) → (Callback)→ System

# Non-Blocking

---

노드에서는 동기(sync)면서 논블로킹(non-blocking)인 거나, 비동기(async)이면서 블로킹(blocking)인 것 거의 없음

// 동기/비동기 와 블로킹/논블로킹에 대한 대략적인 [윤곽은](https://velog.io/@codemcd/Sync-VS-Async-Blocking-VS-Non-Blocking-sak6d01fhx) 여기서 보자.

- **sync vs async : 작업순서**
    - **Synchronous (동기)**
    두 가지 이상의 대상(함수, 애플리케이션 등)이 서로 시간을 맞춰 행동
    - **Asynchronous (비동기)**
    대상이 서로 시간을 맞추지 않는 것을 말한다. 예를 들어 호출하는 함수가 호출되는 함수에게 작업을 맡겨놓고 신경을 쓰지 않는 것
- **non-blocking vs blocking : 작업처리 제어권**
    
    블록킹/논블록킹은 **직접 제어할 수 없는 대상을 처리**하는 방법에 따라 나눈다
    
    - **non-blocking**
    직접 제어할 수 없는 대상의 작업이 끝날 때까지 제어권을 넘겨주지 않는 것.예를 들어 호출하는 함수가 IO를 요청했을 때 IO처리가 완료될 때까지 아무 일도 하지 못한 채 기다리는 것
    - **Non-Blocking**
        
        직접 제어할 수 없는 대상의 작업 처리 여부와 상관이 없다. 예를 들어 호출하는 함수가 IO를 요청한 후 IO처리 완료 여부와 상관없이 바로 자신의 작업을 할 수 있다.
        

> 무조건 스택오버플로우를 신봉하면 안 된다…개 헛소리인데도 [따봉이 14개가 박혀있는 경우](https://stackoverflow.com/questions/8416874/whats-the-differences-between-blocking-with-synchronous-nonblocking-and-asynch#:~:text=Summary%3A%20Blocking%20is%20always%20synchronous,before%20proceeding%20for%20next%20instruction.)를 보았다…
> 

노드에서는 동시에 돌아가는 경우는 일부 경우에 한함.

# Process vs Thread

---

이거이거 갑자기 OS 공부가 되가는 거 같은데…

- 프로세스 : OS 작업 단위. 프로세스 간 자원 공유X
- 스레드 : 프로세스 내 작업 단위. 부모 프로세스 자원 공유 O

**노드 프로세스는 멀티스레드이지만, 직접 다룰 수 있는 스레드는 하나임. 그래서 표현을 싱글이라고 하는 거임. 절대 노드가 싱글스레드인 건 아님** 

// 14버전부터 멀티 스레드 사용이 가능함

노드는 주로 멀티스레드 대신 멀티 프로세스 활용함.

# 스레드와 블로킹 나 이거 제대로 이해한 거 맞을까

---

- 싱글 스레드는 주어진 일 하나밖에 처리하지 못 해서 블로킹 발생 시, 나머지 작업은 대기해야함. 에러를 처리하지 못 하면 아예 뻗어버림
- 멀티 스레드 사용 시,  에러 발생 시 새로운 스레드 생성하나, 스레드 처리비용 발생하여 자원 소모하는 단점. +) 프로그래밍 난이도 어려워

![Untitled](Node%20js%E1%84%85%E1%85%A1%E1%86%AB%20ee4667af474a49959338d6b471bcee9b/Untitled%201.png)

노드는 싱글 스레드, 논 블로킹 모델을 채택하여 일부 코드(I/O)를 백그라운드(다른 프로세스)에서 실행할 수 있게함. // PM2

1. I/O를 다른 프로세스(타 프로세스 싱글스레드.여기서는 점원)를 통해 백그라운드에 맡겨놓음
2. 주요 작업 처리(아마 이벤트 관련 작업 수행 프로세스 싱글스레드로 추정.여기서는 주방) // 논 블로킹에 따라 작업 처리 여부 상관없이 작업 수행
3. 요청에 대한 처리가 완료되면 응답함

여기서 I/O 담당 프로세스 관리가 매우 중요함. 얘가 뻗어버리면 I/O 관리가 안 됨.

이걸 대비하기 위해서 멀티 스레드, 블로킹 모델을 사용함. 여기서도 비동기 처리는 계속 되어야 함.

![Untitled](Node%20js%E1%84%85%E1%85%A1%E1%86%AB%20ee4667af474a49959338d6b471bcee9b/Untitled%202.png)

근데 이게 프로그래밍 난이도가 어렵기 때문에 싱글 스레드를 주력으로 끌고감

- 잉? 그럼 14버전 멀티스레드는?
    
    고거 그냥 배려차원에 넣어준 거 ㅇㅅㅇ. 싱글 스레드만 잘 해도 현업에서 잘 먹힘. 현업에서도 멀티스레드 메인으로 활용 안 함.
    

# 요약

---

## 특징

- Nods.js 라이브러리 내의 api는 모두 비동기
- 단일 스레드.
- 이벤트 메커니즘을 통해 서버가 멈추지 않으며 실시간 데이터 애플리케이션, SPA, I/O 잦은 앱개발에 효율적
    - 여기서 **I/O작업**이란? **파일 시스템** 접근, **DB 접근**, 네트워크 요청과 같은 작업. **컴퓨터의 기본적인 동작 중 가장 느리다.**
    - 느린 이유? 요청을 보낸순간부터 완료될때까지 지연되기 때문
    - 이것을 해결하기 위한 것
        - Non blocking + Sync : 폴링방식으로 busy waiting하기
        - Non blocking + Async : 이벤트 루프
- 하나의 작업 자체가 오래걸리면 전체 성능 저하. (싱글스레드 이기 때문)

## 주요 패키지

### 1. Http 모듈

- HTTP 통신으로 데이터를 주고 받을 수 있는 프로토콜
    - createServer를 통해 server 객체 생성(웹서버 객체)

> HTTP 모듈은 노드에서 가장 기본적인 웹 모듈이며 웹서버뿐만 아니라 클라이언트 생성하는 것과 관련된 모든 기능을 담당한다. 네트워크 기능을 담당하는, 서버를 위한 필수 모듈!
> 

### 2. Express

- 외장 모듈(npm으로 다운)
- package.json : 모듈 버전, 의존 패키지 관리(npm 이용)
- Routing: app.js로 routing 역할 수행
    - URI 및 특정 HTTP 요청메소드인 특정 엔드포인트에 대한 요청에 application이 응답하는 방법을 결정
- 앱 구동

> model 폴더를 생성해서 모델을 관리하고 router 부분의 코드를 잘 만지면 controller로 바뀌어
> 
> 
> MVC 패턴을 만들 수 있다.
> 

### 3. Routing

URI 및 특정한 HTTP 요청메소드인 특정 엔드포인트에 대한 클라이언트 요청에애플리케이션이 응답하는 방법을 결정한다.

### 4. Middleware

클라이언트에게 온 요청을 보내기 위해 응답하려는 중간에 목적에 맞게 처리하는 것이다.

### 5. Sequelize

- DB와 연동할 때 객체와 테이블을 매핑해주는 ORM
- 이걸 이용하면 객체의 메서드를 통해 쿼리를 조작함. sql 문법을 모르더라도.
    - create(), findOne(), findAll(), update(), destroy() 등
- 관계설정
    - 1 : 1 관계 - hasOne, belongsTo
    - 1 : N 관계 - hasMany, belongsTo
    - N : M 관계 - belongsToMany

# Reference

---

1. [https://velog.io/@new_wisdom/Node.js-SOPT-면접-준비](https://velog.io/@new_wisdom/Node.js-SOPT-%EB%A9%B4%EC%A0%91-%EC%A4%80%EB%B9%84)
2. [https://hungryjayy.github.io/posts/Node.js_디자인패턴_1장_1_Node.js_란/](https://hungryjayy.github.io/posts/Node.js_%EB%94%94%EC%9E%90%EC%9D%B8%ED%8C%A8%ED%84%B4_1%EC%9E%A5_1_Node.js_%EB%9E%80/)